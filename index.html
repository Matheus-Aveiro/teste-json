<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualizador de Eventos ICS</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />

    <style>
      body {
        background-color: #f8f9fa;
      }
      .container-md {
        margin-top: 50px;
      }
      .loading-text {
        color: #6c757d;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div class="container-md">
      <div class="text-center mb-5">
        <h1 class="fw-bold">ðŸ“… Eventos do CalendÃ¡rio</h1>
        <p class="text-muted">
          Lista de eventos extraÃ­da diretamente do arquivo
          <a
            href="https://matheus-aveiro.github.io/teste-json/teste.ics"
            target="_blank"
            class="link-primary fw-semibold"
            >teste.ics</a
          >.
        </p>
      </div>

      <div class="text-center mb-4">
        <a
          id="download-btn"
          href="https://matheus-aveiro.github.io/teste-json/teste.ics"
          download="meus-eventos.ics"
          class="btn btn-success btn-lg shadow-sm"
        >
          <i class="bi bi-download me-2"></i> Baixar CalendÃ¡rio (.ics)
        </a>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-primary text-white fw-semibold">
              Lista de Eventos
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table
                  class="table table-striped table-hover align-middle mb-0"
                >
                  <thead class="table-light">
                    <tr>
                      <th scope="col">TÃ­tulo</th>
                      <th scope="col">Local</th>
                      <th scope="col">Data/Hora</th>
                    </tr>
                  </thead>
                  <tbody id="events-table-body">
                    <tr>
                      <td colspan="3" class="text-center loading-text">
                        Carregando eventos...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="card-footer text-muted small">
              Fonte: arquivo ICS hospedado no GitHub
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const icsUrl = "https://matheus-aveiro.github.io/teste-json/teste.ics";
        const tableBody = document.getElementById("events-table-body");
        const downloadBtn = document.getElementById("download-btn");

        fetch(icsUrl)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Erro ao carregar o arquivo .ics");
            }
            return response.text();
          })
          .then((text) => {
            const jcalData = ICAL.parse(text);
            const comp = new ICAL.Component(jcalData);
            const events = comp.getAllSubcomponents("vevent");

            if (events.length === 0) {
              tableBody.innerHTML =
                '<tr><td colspan="3" class="text-center text-muted">Nenhum evento encontrado.</td></tr>';
              return;
            }

            tableBody.innerHTML = "";
            events.forEach((event) => {
              const summary = event.getFirstPropertyValue("summary");
              const location = event.getFirstPropertyValue("location");
              const start = event.getFirstPropertyValue("dtstart").toJSDate();

              const options = {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
              };
              const formattedDate = start.toLocaleString("pt-BR", options);

              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${summary || "N/A"}</td>
                <td>${location || "N/A"}</td>
                <td>${formattedDate || "N/A"}</td>
              `;
              tableBody.appendChild(row);
            });

            downloadBtn.href = icsUrl;
          })
          .catch((error) => {
            console.error("Ocorreu um erro:", error);
            tableBody.innerHTML = `<tr><td colspan="3" class="text-center text-danger">Falha ao carregar eventos. Verifique a URL do arquivo.</td></tr>`;
            downloadBtn.style.display = "none";
          });
      });
    </script>
  </body>
</html>
